---
- hosts: localhost:!all
  connection: local
  gather_facts: no
  vars_files:
    - vars.yml
  roles:
    - eucalyptus-groups
    - couchdb-eucalyptus

- hosts: tag_db_couchdb
  connection: local
  gather_facts: no
  vars_files:
    - vars.yml
  remote_user: debian
  tasks:
    - local_action: wait_for port=22 host="{{ ansible_ssh_host | default(inventory_hostname) }}" search_regex=OpenSSH delay=10

- name: apply common configuration to all nodes
  hosts: tag_db_couchdb
  gather_facts: no
  remote_user: debian

  roles:
    - common

- name: deploy CouchDB
  hosts: tag_db_couchdb
  gather_facts: no
  remote_user: debian
  roles:
    - couchdb
